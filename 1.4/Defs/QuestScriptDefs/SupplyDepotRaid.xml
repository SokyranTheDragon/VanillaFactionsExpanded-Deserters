<?xml version="1.0" encoding="UTF-8"?>
<Defs>
    <QuestScriptDef>
        <defName>VFED_SupplyDepotRaid</defName>
	    <rootSelectionWeight>2</rootSelectionWeight>
		<expireDaysRange>15~30</expireDaysRange>
	    <questNameRules>
		    <rulesStrings>
			    <li>questName->Supply Depot Raid</li>
		    </rulesStrings>
	    </questNameRules>
	    <questDescriptionRules>
		    <rulesStrings>
			    <li>questDescription->The intel we have gathered allowed us to gain insight into the location of a supply depot belonging to [empire_name]. Supply depots like that are often scattered around imperial settlements and serve as secure stockpiles for the most valuable resources. Keeping these supply depots hidden away discourages any raiders from attacking these settlements.
\nThe compound is guaranteed to contain numerous supply crates. Stealing these items is bound to slow down the Imperial war effort.
\nIt is also possible we will find additional Biosecured crates, which can only be opened by noble-born people.
\nThe supply depot is protected by:
[forces_description]
\nThe compound is protected by surveillance pillars. They should not be approached, and instead should be disabled from afar - either by destroying them, or cutting off their power. Once activated, they will greatly increase our visibility.
\nThe objective of this assignment is to open all supply crates in the area. Once that is done, the reward will arrive and we will have to make our escape.
\nOnce we arrive at the compound, we can expect an imperial response if our visibility is high enough. We will only have a limited amount of time to complete the mission.</li>
		    </rulesStrings>
	    </questDescriptionRules>
	    <root Class="QuestNode_Sequence">
		    <nodes>
			    <li Class="VFED.QuestNode_GetEmpire">
				    <storeAs>empire</storeAs>
			    </li>
			    <li Class="VFED.QuestNode_GetDeserters">
				    <storeAs>deserters</storeAs>
			    </li>
				<li Class="QuestNode_GetMap" />
			    <li Class="QuestNode_SubScript">
				    <def>Util_RandomizePointsChallengeRating</def>
			    </li>
			    <li Class="QuestNode_SubScript">
				    <def>Util_AdjustPointsForDistantFight</def>
			    </li>
			    <li Class="QuestNode_GetSiteTile">
				    <storeAs>siteTile</storeAs>
				    <preferCloserTiles>true</preferCloserTiles>
			    </li>
			    <li Class="QuestNode_GetDefaultSitePartsParams">
				    <tile>$siteTile</tile>
				    <faction>$empire</faction>
				    <sitePartDefs><li>VFED_SupplyDepot</li></sitePartDefs>
				    <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
			    </li>
				<li Class="QuestNode_Set">
					<name>siteFaction</name>
					<value>$empire</value>
				</li>
			    <li Class="QuestNode_GetSiteThreatPoints">
				    <storeAs>sitePoints</storeAs>
				    <sitePartsParams>$sitePartsParams</sitePartsParams>
			    </li>
			    <li Class="QuestNode_SubScript">
				    <def>Util_GetDefaultRewardValueFromPoints</def>
				    <parms>
					    <points>($sitePoints + $points)</points>
				    </parms>
			    </li>
			    <li Class="QuestNode_Multiply">
				    <value1>$rewardValue</value1>
				    <value2>1.25</value2>
				    <storeAs>rewardValue</storeAs>
			    </li>
			    <li Class="QuestNode_Multiply">
				    <value1>$rewardValue</value1>
				    <value2>2.5</value2>
				    <storeAs>rewardValue</storeAs>
			    </li>
			    <li Class="QuestNode_SubScript">
				    <def>Util_GenerateSite</def>
			    </li>
			    <li Class="QuestNode_SpawnWorldObjects">
				    <worldObjects>$site</worldObjects>
			    </li>
				<li Class="VFED.QuestNode_MarkObjectives">
					<inSignal>site.MapGenerated</inSignal>
					<mapParent>$site</mapParent>
					<objectiveDef>VFED_SupplyCrate</objectiveDef>
					<objectiveCompleteSignal>Opened</objectiveCompleteSignal>
				</li>
				<li Class="VFED.QuestNode_ImperialForces">
					<inSignal>site.MapGenerated</inSignal>
					<mapParent>$site</mapParent>
					<points>$points</points>
				</li>
				<li Class="VFED.QuestNode_ImperialResponse">
					<siteName>site</siteName>
				</li>
				<li Class="VFECore.QuestNode_ForceMusic">
					<inSignalEnable>site.MapGenerated</inSignalEnable>
					<inSignalDisable>site.MapRemoved</inSignalDisable>
					<possibleSongs>
						<li>VFED_Stealth1</li>
						<li>VFED_Stealth2</li>
						<li>VFED_Stealth3</li>
					</possibleSongs>
					<priority>2</priority>
				</li>
			    <li Class="VFED.QuestNode_DeserterRewards">
					<inSignal>objectives.Complete</inSignal>
			    </li>
				<li Class="QuestNode_End">
					<inSignal>objectives.Complete</inSignal>
					<outcome>Success</outcome>
					<sendStandardLetter>true</sendStandardLetter>
				</li>
				<li Class="QuestNode_End">
					<inSignal>site.Destroyed</inSignal>
					<outcome>Fail</outcome>
					<sendStandardLetter>true</sendStandardLetter>
				</li>
		    </nodes>
	    </root>
    </QuestScriptDef>
</Defs>